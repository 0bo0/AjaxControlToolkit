// (c) 2010 CodePlex Foundation
(function(){var b="HtmlEditorExtenderBehavior";function a(){var f="ToolbarButtons",d=false,c="blur",b=true,e="unselectable",a=null;Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.HtmlEditorExtenderButton=function(){var b=this;b._commandName=a;b._iconIndex=a;b._tooltip=a;b._offset=a};Sys.Extended.UI.HtmlEditorExtenderButton.prototype={get_CommandName:function(){return this._commandName},set_CommandName:function(){if(this._commandName!=value){this._commandName=value;this.raisePropertyChanged("CommandName")}},get_Tooltip:function(){return this._tooltip+"test-prototype-success"},set_Tooltip:function(){if(this._tooltip!=value){this._tooltip=value;this.raisePropertyChanged("Tooltip")}},get_IconIndex:function(){return this._iconIndex},set_IconIndex:function(){if(this._iconIndex!=value){this._iconIndex=value;this.raisePropertyChanged("IconIndex")}},get_Offset:function(){return this._offset},set_Offset:function(){if(this._iconIndex!=value){this._iconIndex=value;this.raisePropertyChanged("Offset")}}};Sys.Extended.UI.HtmlEditorExtenderButton.registerClass("Sys.Extended.UI.HtmlEditorExtenderButton");Sys.Extended.UI.HtmlEditorExtenderBehavior=function(f){var c=this;Sys.Extended.UI.HtmlEditorExtenderBehavior.initializeBase(c,[f]);c._textbox=Sys.Extended.UI.TextBoxWrapper.get_Wrapper(f);var d=c.get_id();c._ButtonWidth=23;c._ButtonHeight=21;c._containerTemplate={nodeName:"div",properties:{id:d+"_ExtenderContainer"},cssClasses:[e,"ajax__html_editor_extender_container"]};c._editableTemplate={nodeName:"div",properties:{id:d+"_ExtenderContentEditable",style:{width:"100%",height:"100%",overflow:"auto",clear:"both"},contentEditable:b},cssClasses:["ajax__html_editor_extender_texteditor"]};c._buttonTemplate={nodeName:"input",properties:{type:"button",style:{width:c._ButtonWidth+"px",height:c._ButtonHeight+"px"}},cssClasses:["ajax__html_editor_extender_button"]};c._topButtonContainerTemplate={nodeName:"div",properties:{id:d+"_ExtenderButtonContainer"},cssClasses:["ajax__html_editor_extender_buttoncontainer"]};c._container=a;c._toolbarButtons=a;c._editableDiv=a;c._topButtonContainer=a;c._buttons=[];c._btnClickHandler=a;c._requested_buttons=[]};Sys.Extended.UI.HtmlEditorExtenderBehavior.prototype={initialize:function(){var d=this;Sys.Extended.UI.HtmlEditorExtenderBehavior.callBaseMethod(d,"initialize");var j=0;d._button_list=[];d._createContainer();d._createTopButtonContainer();d._createEditableDiv();d._createButton();var e=d._textbox._element.parentNode;while(e!=a&&e.nodeName!="FORM")e=e.parentNode;if(e==a)throw"Missing Form tag";var h=Function.createDelegate(d,d._editableDiv_submit),g=Function.createDelegate(d,d._textBox_onblur),f=Function.createDelegate(d,d._editableDiv_onblur),i=Function.createDelegate(d,d._executeCommand);$addHandler(d._textbox._element,c,g,b);$addHandler(d._editableDiv,c,f,b);$addHandler(e,"submit",h,b);$addHandler(d._topButtonContainer,"click",i)},_dispose:function(){$removeHandler(this._textbox._element,c,delTextBox_onblur);$removeHandler(this._editableDiv,c,delEditableDiv_onblur);$removeHandler(formElement,"submit",formSubmitHandler);$removeHandler(_topButtonContainer,"click",btnClickHandler);Sys.Extended.UI.HtmlEditorExtenderBehavior.callBaseMethod(this,"dispose")},_createContainer:function(){var a=this,c=a.get_element();a._container=$common.createElementFromTemplate(a._containerTemplate,c.parentNode);var b=$common.getBounds(a._textbox._element);$common.setSize(a._container,{width:b.width,height:b.height});$common.wrapElement(a._textbox._element,a._container,a._container)},_createTopButtonContainer:function(){this._topButtonContainer=$common.createElementFromTemplate(this._topButtonContainerTemplate,this._container)},_createButton:function(){var a=this;for(i=0;i<a._toolbarButtons.length;i++){var b=$common.createElementFromTemplate(a._buttonTemplate,a._topButtonContainer);b.setAttribute("id",a._id+a._toolbarButtons[i].CommandName);b.setAttribute("name",a._toolbarButtons[i].CommandName);b.setAttribute("title",a._toolbarButtons[i].Tooltip);b.setAttribute(e,"on");b.style.backgroundPosition=a._toolbarButtons[i].Offset;Array.add(a._buttons,b)}},_createEditableDiv:function(){var a=this;a._editableDiv=$common.createElementFromTemplate(a._editableTemplate,a._container);a._editableDiv.innerHTML=a._textbox._element.value;$common.setVisible(a._textbox._element,d)},_editableDiv_onblur:function(){this._textbox._element.value=this.innerHTML},_textBox_onblur:function(){this._editableDiv.innerHTML=this.value},_editableDiv_submit:function(){var c=this,e=3,b=a;c._editableDiv.focus();if(Sys.Browser.agent!=Sys.Browser.Firefox)if(document.selection){b=document.selection.createRange();b.moveStart("character",e);b.select()}else{b=window.getSelection();b.collapse(c._editableDiv.firstChild,e)}var d=c._editableDiv.innerHTML.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\"/ig,"&quot;").replace(/\xA0/ig,"&nbsp;");d=d.replace(/&lt;STRONG&gt;/ig,"&lt;b&gt;").replace(/&lt;\/STRONG&gt;/ig,"&lt;/b&gt;").replace(/&lt;EM&gt;/ig,"&lt;i&gt;").replace(/&lt;\/EM&gt;/ig,"&lt;/i&gt;");c._textbox._element.value=d},_executeCommand:function(c){var b=Sys.Browser.agent==Sys.Browser.Firefox;b&&document.execCommand("styleWithCSS",d,d);document.execCommand(c.target.name,d,a)},get_ButtonWidth:function(){return this._ButtonWidth},set_ButtonWidth:function(a){if(this._ButtonWidth!=a){this._ButtonWidth=a;this.raisePropertyChanged("ButtonWidth")}},get_ButtonHeight:function(){return this._ButtonHeight},set_ButtonHeight:function(a){if(this._ButtonHeight!=a){this._ButtonHeight=a;this.raisePropertyChanged("ButtonHeight")}},get_ToolbarButtons:function(){return this._toolbarButtons},set_ToolbarButtons:function(a){if(this._toolbarButtons!=a){this._toolbarButtons=a;this.raisePropertyChanged(f)}}};Sys.Extended.UI.HtmlEditorExtenderBehavior.registerClass("Sys.Extended.UI.HtmlEditorExtenderBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.HtmlEditorExtenderBehavior,{name:"HtmlEditorExtender",parameters:[{name:f,type:"HtmlEditorExtenderButton[]"}]})}if(window.Sys&&Sys.loader)Sys.loader.registerScript(b,["ExtendedBase","ExtendedCommon"],a);else a()})();