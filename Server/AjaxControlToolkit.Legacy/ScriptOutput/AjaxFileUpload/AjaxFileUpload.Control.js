Type.registerNamespace("Sys.Extended.UI.AjaxFileUpload");Type.registerNamespace("AjaxFileUpload");Sys.Extended.UI.AjaxFileUpload.Control=function(d){var c=false,b=null,a=this;Sys.Extended.UI.AjaxFileUpload.Control.initializeBase(a,[d]);a._allowedFileTypes=b;a._contextKey=b;a._postBackUrl=b;a._mode=0;a._serverPollingSupport=c;a._throbber=b;a._maximumNumberOfFiles=10;a._allowedFileTypes="";a._chunkSize=4096;a._storeToAzure=c;a._azureContainerName="";a._uploadUrl="AjaxFileUploadHandler.axd";a._useHtml5Support=c;a._elements=b;a._processor=b;a._filesInQueue=[];a._isUploading=c;a._currentFileId=b;a._canceled=c};Sys.Extended.UI.AjaxFileUpload.Control.prototype={initialize:function(){var a=this,e=new Sys.Extended.UI.AjaxFileUpload.Utils,f=a.get_id(),b=function(a){return document.getElementById(f+a)},c={queueContainer:b("_QueueContainer"),selectFileButton:b("_SelectFileButton"),uploadOrCancelButton:b("_UploadOrCancelButton"),fileStatusContainer:b("_FileStatusContainer"),footer:b("_Footer")};a._useHtml5Support=e.checkHtml5BrowserSupport()&&a._mode!=2;c.progressBar=b("_ProgressBar");c.progressBarContainer=b("_ProgressBarContainer");if(a._useHtml5Support){c.inputFile=b("_Html5InputFile");c.dropZone=b("_Html5DropZone")}else c.inputFile=b("_InputFileElement");a._elements=c;var d=a._useHtml5Support?new Sys.Extended.UI.AjaxFileUpload.ProcessorHtml5(a,c):new Sys.Extended.UI.AjaxFileUpload.Processor(a,c);a.setDefaultElementsLayout(c);a.attachEvents(c);d.initialize();a._processor=d;Sys.Extended.UI.AjaxFileUpload.Control.callBaseMethod(a,"initialize")},dispose:function(){Sys.Extended.UI.AjaxFileUpload.Control.callBaseMethod(this,"dispose")},setDefaultElementsLayout:function(a){$common.setVisible(a.inputFile,true);$common.setVisible(a.uploadOrCancelButton,false);$common.setVisible(a.fileStatusContainer,true);a.selectFileButton.innerHTML=Sys.Extended.UI.Resources.AjaxFileUpload_SelectFile;a.uploadOrCancelButton.innerHTML=Sys.Extended.UI.Resources.AjaxFileUpload_Upload;this.setStatusMessage(Sys.Extended.UI.Resources.AjaxFileUpload_SelectFileToUpload)},attachEvents:function(b){var a=this;a.onUploadOrCancelButtonClicked$delegate=Function.createDelegate(a,a.onUploadOrCancelButtonClickedHandler);$addHandlers(b.uploadOrCancelButton,{click:a.onUploadOrCancelButtonClicked$delegate})},onUploadOrCancelButtonClickedHandler:function(){var a=this,b=a._filesInQueue;if(!b.length){alert(Sys.Extended.UI.Resources.AjaxFileUpload_SelectFileToUpload);return}for(var d=0,c=0;c<b.length;c++)if(b[c]._isUploaded)d++;if(d==b.length){alert(Sys.Extended.UI.Resources.AjaxFileUpload_AllFilesUploaded);return}a.enableControls(a._isUploading);a._isUploading=!a._isUploading;if(a._isUploading){a._canceled=false;a._processor.startUpload()}else{a._canceled=true;a._processor.cancelUpload();for(var c=0;c<b.length;c++)if(!b[c]._isUploaded)b[c]._isUploading=false}},enableControls:function(a){var b=this,c=b._elements.uploadOrCancelButton;$common.setText(c,a?Sys.Extended.UI.Resources.AjaxFileUpload_Upload:Sys.Extended.UI.Resources.AjaxFileUpload_Cancel);c.setAttribute("class",a?"ajax__fileupload_uploadbutton":"ajax_fileupload_cancelbutton");$common.setVisible(b._elements.inputFile,a);if(b._useHtml5Support){b._elements.dropZone.disable=!a;b._elements.inputFile.disable=!a}},done:function(){var a=this;a._isUploading=false;a.enableControls(true);a.setStatusMessage(Sys.Extended.UI.Resources.AjaxFileUpload_AllFilesUploaded+" "+Sys.Extended.UI.Resources.AjaxFileUpload_SelectFileToUpload);$common.setVisible(a._elements.uploadOrCancelButton,false);a._filesInQueue=[]},removeFileFromQueueHandler:function(b){var a=this;if(!b||b._isUploading)return;Array.remove(a._filesInQueue,b);b.removeNodeFrom(a._elements.queueContainer);if(!a._elements.queueContainer.hasChildNodes()){$common.setVisible(a._elements.queueContainer,false);$common.setVisible(a._elements.uploadOrCancelButton,false)}a._showFilesCount()},addFileToQueue:function(d){var a=this,c=a.get_maximumNumberOfFiles();if(c>0&&a._filesInQueue.length>=c){alert(Sys.Extended.UI.Resources.AjaxFileUpload_MaxNumberOfFilesExceeded);return false}var b=new Sys.Extended.UI.AjaxFileUpload.Item(a.get_id(),d,Function.createDelegate(a,a.removeFileFromQueueHandler));b.appendNodeTo(a._elements.queueContainer);b.setStatus("pending",Sys.Extended.UI.Resources.AjaxFileUpload_Pending);$common.setVisible(a._elements.queueContainer,true);$common.setVisible(a._elements.uploadOrCancelButton,true);a._filesInQueue.push(b);a._showFilesCount();return true},_showFilesCount:function(){var a=this._filesInQueue.length==0;this.setStatusMessage(a?Sys.Extended.UI.Resources.AjaxFileUpload_SelectFileToUpload:String.format(Sys.Extended.UI.Resources.AjaxFileUpload_FileInQueue,this._filesInQueue.length.toString()))},fileTypeIsValid:function(c){if(!this._allowedFileTypes)return true;for(var b=this._allowedFileTypes.split(","),a=0;a<b.length;a++){var d=b[a];if(c.toLocaleLowerCase()==d.toLocaleLowerCase())return true}return false},confirmFileIsInvalid:function(a){var b=new Sys.Extended.UI.AjaxFileUpload.Utils;alert(String.format(Sys.Extended.UI.Resources.AjaxFileUpload_WrongFileType,b.getFileName(a.value),a.type))},doneAndUploadNextFile:function(c){var a=new XMLHttpRequest,b=this;a.open("POST","?contextKey="+this._contextKey+"&done=1&guid="+c._id,true);a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200){b.raiseUploadComplete(Sys.Serialization.JavaScriptSerializer.deserialize(a.responseText));b._processor.startUpload()}else{b.setFileStatus(c,"error",Sys.Extended.UI.Resources.AjaxFileUpload_error);b.raiseUploadError(a);throw"error raising upload complete event and start new upload";}};a.send(null)},setAsUploading:function(a){var b=this;a._isUploading=true;a._isUploaded=false;b.setFileStatus(a,"uploading",Sys.Extended.UI.Resources.AjaxFileUpload_Uploading);b.setStatusMessage("Uploading "+(Array.indexOf(b._filesInQueue,a)+1)+" of "+b._filesInQueue.length+" file(s)")},setFileStatus:function(a,b,c){if(typeof a==="string")a=this.getFileItem(a);a&&a.setStatus(b,c)},setStatusMessage:function(a){this._elements.fileStatusContainer.innerHTML=a},setPercent:function(a){var b=this._elements.progressBar;if(a<=0)a="0";else if(a>=100)a="100";b.style.width=a+"%";$common.setText(b,String.format(Sys.Extended.UI.Resources.AjaxFileUpload_UploadedPercentage,a))},get_allowedFileTypes:function(){return this._allowedFileTypes},set_allowedFileTypes:function(a){this._allowedFileTypes=a},get_contextKey:function(){return this._contextKey},set_contextKey:function(a){this._contextKey=a},get_postBackUrl:function(){return this._postBackUrl},set_postBackUrl:function(a){this._postBackUrl=a},get_mode:function(){return this._mode},set_mode:function(a){this._mode=a},get_serverPollingSupport:function(){return this._serverPollingSupport},set_serverPollingSupport:function(a){this._serverPollingSupport=a},get_throbber:function(){return this._throbber},set_throbber:function(a){this._throbber=a},get_maximumNumberOfFiles:function(){return this._maximumNumberOfFiles},set_maximumNumberOfFiles:function(a){this._maximumNumberOfFiles=a},get_chunkSize:function(){return this._chunkSize},set_chunkSize:function(a){this._chunkSize=a},get_storeToAzure:function(){return this._storeToAzure},set_storeToAzure:function(a){this._storeToAzure=a},get_azureContainerName:function(){return this._azureContainerName},set_azureContainerName:function(a){this._azureContainerName=a},add_uploadComplete:function(a){this.get_events().addHandler("uploadComplete",a)},remove_uploadComplete:function(a){this.get_events().removeHandler("uploadComplete",a)},raiseUploadComplete:function(c){var a=this,b=a.getCurrentFileItem();if(!b||!c||c.FileId!==b._id)throw"Invalid finalizing upload server response.";a.setFileStatus(b,"uploaded",Sys.Extended.UI.Resources.AjaxFileUpload_Uploaded);a.setStatusMessage("Uploaded "+(Array.indexOf(a._filesInQueue,b)+1)+" of "+a._filesInQueue.length+" file(s)");b._isUploaded=true;b._isUploading=false;b.hide();var d=a.get_events().getHandler("uploadComplete");if(d){var f=Array.indexOf(a._filesInQueue,b),e=new Sys.Extended.UI.AjaxFileUploadEventArgs(c.FileId,"Success",c.FileName,c.FileSize,c.ContentType,c.PostedUrl,f,a._filesInQueue.length);d(a,e)}},add_uploadError:function(a){this.get_events().addHandler("uploadError",a)},remove_uploadError:function(a){this.get_events().removeHandler("uploadError",a)},raiseUploadError:function(c){var a=this,b=a.get_events().getHandler("uploadError");b&&b(a,c);a._canceled=false;a._isUploading=false;a.enableControls(true)},getCurrentFileItem:function(){return this.getFileItem(this._currentFileId)},getNextFile:function(){if(!this._isUploading)return null;for(var a=0;a<this._filesInQueue.length;a++){var b=this._filesInQueue[a];if(!b._isUploaded)return b}return null},getFileItem:function(c){for(var a=0;a<this._filesInQueue.length;a++){var b=this._filesInQueue[a];if(b._id===c)return b}return null}};Sys.Extended.UI.AjaxFileUpload.Control.registerClass("Sys.Extended.UI.AjaxFileUpload.Control",Sys.Extended.UI.ControlBase);