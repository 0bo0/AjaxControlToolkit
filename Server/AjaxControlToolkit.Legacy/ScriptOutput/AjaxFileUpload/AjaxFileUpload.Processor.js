Type.registerNamespace("Sys.Extended.UI.AjaxFileUpload");Type.registerNamespace("AjaxFileUpload");Sys.Extended.UI.AjaxFileUpload.Processor=function(a,g){var i="none",h="?contextKey=",j="act-file-data",e=false,b=true,c=null,d=this,k=new Sys.Extended.UI.AjaxFileUpload.Utils,f=new XMLHttpRequest;d._iframe=c;d._iframeName=a.get_id()+"_uploadIframe";d._form=c;d.initialize=function(){this.attachEvents();this.createIFrame();this.createForm()};d.attachEvents=function(){var c=this;c.onFileSelected$delegate=Function.createDelegate(c,c.onFileSelectedHandler);c.attachFileInputEvents(g.inputFile,b);var d=c;f.onreadystatechange=function(){if(f.readyState==4)if(f.status==200){var c=f.responseText;if(c){c=parseFloat(c).toFixed(2);a.setPercent(c)}c<100&&setTimeout(function(){d.pollingServerProgress(b)},500)}}};d.attachFileInputEvents=function(a,b){if(b)$addHandlers(a,{change:this.onFileSelected$delegate});else $common.removeHandlers(a,{change:this.onFileSelected$delegate})},d.onFileSelectedHandler=function(){var b={id:k.generateGuid(),value:g.inputFile,type:k.getFileType(g.inputFile.value)};if(a.fileTypeIsValid(b.type)){a.addFileToQueue(b);this.createInputFileElement()}else a.confirmFileIsInvalid(b)};d.createInputFileElement=function(){var c=g.inputFile;c.style.zIndex=-999;$common.setLocation(c,{x:-99999,y:-99999});this.attachFileInputEvents(c,e);var f=a.get_id()+"_file_"+k.generateGuid(),d=$common.createElementFromTemplate({nodeName:"input",properties:{id:f,name:j,type:"file",style:{zIndex:0,cursor:"pointer",position:"absolute"}}},c.parentNode);$common.setElementOpacity(d,0);this.attachFileInputEvents(d,b);g.inputFile=d};d.startUpload=function(){var d=this._form,f=a.getNextFile();if(!f){a._currentFileId=c;this.setThrobber(e);a.done();return}a.setAsUploading(f);var g=f.get_inputElementValue();a._currentFileId=f._id;this.setThrobber(b);while(d.firstChild)d.removeChild(d.firstChild);g.name=j;d.appendChild(g);d.setAttribute("action",a._uploadUrl+h+a._contextKey+"&fileId="+a._currentFileId+"&fileName="+f._fileName+"&usePoll="+(a.get_serverPollingSupport()?"true":"false")+"&storeToAzure="+a.get_storeToAzure()+"&acn="+a.get_azureContainerName());d.submit()};d.cancelUpload=function(){var d=new XMLHttpRequest,g=this;f&&f.abort();d.open("POST",h+a._contextKey+"&cancel=1&guid="+a._currentFileId,b);d.onreadystatechange=function(){g.setThrobber(e);if(d.readyState==4)if(d.status==200)a.cancelUpload();else{g.raiseUploadError(d);throw"Failed to cancel upload.";}};d.send(c)},d.createIFrame=function(){var b=this,c=b._iframeName,a=document.createElement("IFRAME");a.width="0";a.height="0";a.style.display=i;a.src="about:blank";a.id=c;a.name=c;a.security="restricted";document.body.appendChild(a);a.contentWindow.name=c;$addHandlers(a,{load:Function.createDelegate(b,b.onIFrameLoadedHandler)});b._iframe=a};d.onIFrameLoadedHandler=function(){if(!a._currentFileId)return;try{var b=this._iframe,d=c;if(b.contentDocument)d=b.contentDocument;else if(b.contentWindow)d=b.contentWindow.document;else if(b.document)d=b.document;if(d==c)throw"Document not initialized";a.doneAndUploadNextFile(a.getCurrentFileItem())}catch(e){if(!a._canceled||!(e.message&&(e.message.indexOf("Access is denied")>-1||e.message.indexOf("Permission denied")>-1))){this.raiseUploadError(e);throw e;}}};d.setThrobber=function(d){if(a.get_serverPollingSupport()){a.setPercent(0);$common.setVisible(g.progressBar,d?b:e);$common.setVisible(g.progressBarContainer,d?b:e);this.pollingServerProgress(d);return}if(a.get_throbber()!=c)a.get_throbber().style.display=d?"":i};d.pollingServerProgress=function(d){if(!d||!a._currentFileId)return;f.open("GET",h+a._contextKey+"&poll=1&guid="+a._currentFileId,b);f.send(c)};d.createForm=function(){var b,c="___postForm"+a.get_id();try{b=document.createElement('<form method="post" enctype="multipart/form-data" id="'+c+'" target="'+this._iframeName+'">')}catch(d){b=document.createElement("form");b.setAttribute("id",c);b.setAttribute("method","post");b.setAttribute("target",this._iframe.id);b.setAttribute("enctype","multipart/form-data")}b.style.visibility="hidden";b.style.display=i;document.body.appendChild(b);this._form=b};d.raiseUploadError=function(b){a.raiseUploadError(b);a.setFileStatus(a._currentFileId,"error",Sys.Extended.UI.Resources.AjaxFileUpload_error);f&&f.abort();a._currentFileId=c}};