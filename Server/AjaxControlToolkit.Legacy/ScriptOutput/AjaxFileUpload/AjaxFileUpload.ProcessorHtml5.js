Type.registerNamespace("Sys.Extended.UI.AjaxFileUpload");Type.registerNamespace("AjaxFileUpload");Sys.Extended.UI.AjaxFileUpload.ProcessorHtml5=function(a,d){var b=false,e=true,c=this,h=new Sys.Extended.UI.AjaxFileUpload.Utils,g=a.get_chunkSize()*1e3,f=0,i=null;c.initialize=function(){$common.setVisible(d.dropZone,e);d.dropZone.innerHTML=Sys.Extended.UI.Resources.AjaxFileUpload_DropFiles;this.attachEvents()};c.attachEvents=function(){var a=this;a.onFileDropped$delegate=Function.createDelegate(a,a.onFileDroppedHandler);a.onFileDragOver$delegate=Function.createDelegate(a,a.onFileDragOverHandler);a.onFileSelected$delegate=Function.createDelegate(a,a.onFileSelectedHandler);d.inputFile.addEventListener("change",a.onFileSelected$delegate,b);d.dropZone.addEventListener("drop",a.onFileDropped$delegate,b);d.dropZone.addEventListener("dragover",a.onFileDragOver$delegate,b)};c.onFileDroppedHandler=function(a){a.stopPropagation();a.preventDefault();this.addFilesToQueue(a.dataTransfer.files)};c.onFileDragOverHandler=function(a){a.stopPropagation();a.preventDefault()};c.onFileSelectedHandler=function(a){this.addFilesToQueue(a.target.files)};c.addFilesToQueue=function(e){for(var c=0;c<e.length;c++){var j=e[c],i=0;if(j.size>g)i=Math.ceil(j.size/g);var f={id:h.generateGuid(),value:e[c],type:h.getFileType(e[c]),uploaded:b,slices:i};if(a.fileTypeIsValid(f.type)){if(!a.addFileToQueue(f))break}else a.confirmFileIsInvalid(f)}d.inputFile.value=null};c.cancelUpload=function(){i&&i.abort();a.cancelUpload()},c.startUpload=function(){var c=a.getNextFile();if(c){c._sliceIndex===0&&a.setPercent(0);$common.setVisible(d.progressBarContainer,e);this.upload(c)}else{a._currentFileId=null;a.setPercent(0);$common.setVisible(d.progressBarContainer,b);a.done()}};c.upload=function(c){var h=this;if(!a._isUploading)return;$common.setVisible(d.progressBar,e);a.setAsUploading(c);var i=c.get_inputElementValue(),q=c._fileName,k=c._slices&&c._slices>0,p=c._sliceIndex==0;if(k){var l=c._sliceIndex*g,n=l+g;i=i.slice(l,n>i.size?i.size:n)}var m=new FormData,o=a._currentFileId=c._id,f=new XMLHttpRequest,r=h,j=function(a){return function(b){a.call(r,o,b)}};f.upload.addEventListener("progress",j(h.onProgressHandler),b);f.addEventListener("load",j(h.onUploadCompleteHandler),b);f.addEventListener("error",j(h.onUploadFailedHandler),b);f.addEventListener("abort",j(h.onUploadCanceledHandler),b);f.open("POST",a._uploadUrl+"?contextKey="+a._contextKey+"&fileId="+o+"&fileName="+q+"&chunked="+(k?"true":"false")+"&firstChunk="+p+"&storeToAzure="+a.get_storeToAzure()+"&acn="+a.get_azureContainerName(),e);m.append("act-file-data",i);f.send(m)};c.onProgressHandler=function(i,b){if(!a._isUploading)return;if(b.lengthComputable){f=b.loaded;var c=a.getFileItem(i),d=c._slices,e=c._bytesUploaded+f,g=d-c._sliceIndex==1?e:b.total*d,h=d==0?(b.loaded*100/b.total).toFixed(2):(e/g*100).toFixed(2);a.setPercent(h)}};c.onUploadCompleteHandler=function(e){var d=this,b=a.getFileItem(e),c=b.get_inputElementValue();if(b._slices&&b._slices>0&&b._sliceIndex+1<b._slices){b._sliceIndex++;b._bytesUploaded+=f;f=0;d.startUpload()}else{b.hide();b.setStatus("uploaded",Sys.Extended.UI.Resources.AjaxFileUpload_Uploaded);a.setStatusMessage(String.format(Sys.Extended.UI.Resources.AjaxFileUpload_UploadingHtml5File,c.name,h.sizeToString(c.size)));a.doneAndUploadNextFile(b)}};c.onUploadFailedHandler=function(c,e){var d=a.getFileItem(c);d._isUploading=b;a.setFileStatus(c,"error",Sys.Extended.UI.Resources.AjaxFileUpload_error);a.raiseUploadError(e)};c.onUploadCanceledHandler=function(d){var c=a.getFileItem(d);c._isUploading=b;a.setFileStatus(c,"canceled",Sys.Extended.UI.Resources.AjaxFileUpload_Canceled)}};