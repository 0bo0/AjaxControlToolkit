// (c) 2010 CodePlex Foundation
(function(){var b="ExtendedCascadingDropDown";function a(){var h="populated",g="populating",f="selectionChanged",b="",c=true,e="change",d=false,a=null;Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.CascadingDropDownSelectionChangedEventArgs=function(b,a){Sys.Extended.UI.CascadingDropDownSelectionChangedEventArgs.initializeBase(this);this._oldValue=b;this._newValue=a};Sys.Extended.UI.CascadingDropDownSelectionChangedEventArgs.prototype={get_oldValue:function(){return this._oldValue},get_newValue:function(){return this._newValue}};Sys.Extended.UI.CascadingDropDownSelectionChangedEventArgs.registerClass("Sys.Extended.UI.CascadingDropDownSelectionChangedEventArgs",Sys.EventArgs);Sys.Extended.UI.CascadingDropDownBehavior=function(c){var b=this;Sys.Extended.UI.CascadingDropDownBehavior.initializeBase(b,[c]);b._parentControlID=a;b._category=a;b._promptText=a;b._loadingText=a;b._promptValue=a;b._emptyValue=a;b._emptyText=a;b._servicePath=location.pathname;b._serviceMethod=a;b._contextKey=a;b._useContextKey=d;b._useHttpGet=d;b._enableAtLoading=d;b._parentElement=a;b._changeHandler=a;b._parentChangeHandler=a;b._lastParentValues=a;b._selectedValue=a;b._actualDisabledStatus=d};Sys.Extended.UI.CascadingDropDownBehavior.prototype={initialize:function(){var b=this;Sys.Extended.UI.CascadingDropDownBehavior.callBaseMethod(b,"initialize");$common.prepareHiddenElementForATDeviceUpdate();var d=b.get_element();b._actualDisabledStatus=d.disabled;b._clearItems();d.CascadingDropDownCategory=b._category;b._changeHandler=Function.createDelegate(b,b._onChange);$addHandler(d,e,b._changeHandler);if(b._parentControlID){b._parentElement=$get(b._parentControlID);!b._parentElement&&Sys.Debug.fail(String.format(Sys.Extended.UI.Resources.CascadingDropDown_NoParentElement,b._parentControlID));if(b._parentElement){d.CascadingDropDownParentControlID=b._parentControlID;b._parentChangeHandler=Function.createDelegate(b,b._onParentChange);$addHandler(b._parentElement,e,b._parentChangeHandler);if(!b._parentElement.childDropDown)b._parentElement.childDropDown=[];b._parentElement.childDropDown.push(b)}}b._onParentChange(a,c);var f=b;setTimeout(function(){if(f._actualDisabledStatus)d.disabled=f._actualDisabledStatus},50)},dispose:function(){var b=this,c=b.get_element();if(b._changeHandler){$removeHandler(c,e,b._changeHandler);b._changeHandler=a}if(b._parentChangeHandler){b._parentElement&&$removeHandler(b._parentElement,e,b._parentChangeHandler);b._parentChangeHandler=a}Sys.Extended.UI.CascadingDropDownBehavior.callBaseMethod(b,"dispose")},_clearItems:function(){var b=this.get_element();if(b!=a&&b.options!=a)while(0<b.options.length)b.remove(0)},_isPopulated:function(){var a=this.get_element().options.length;return this._promptText?a>1:a>0},_setOptions:function(h,u,m){var f=this;if(!f.get_isInitialized())return;var g=f.get_element();f._clearItems();var n,o=b;if(m&&f._loadingText){n=f._loadingText;if(f._selectedValue)o=f._selectedValue}else if(!m&&h&&0==h.length&&a!=f._emptyText){n=f._emptyText;if(f._emptyValue)o=f._emptyValue}else if(f._promptText){n=f._promptText;if(f._promptValue)o=f._promptValue}var k;if(n){k=new Option(n,o);g.options[g.options.length]=k}var i=a,l=-1;if(h){for(var j=0;j<h.length;j++){var p=h[j],t=p.name,r=p.value,q=p.optionTitle;if(p.isDefaultValue){f.set_SelectedValue(r,t,q);l=j;if(f._promptText)l++}k=new Option(t,r);if(r==f._selectedValue)i=k;q&&k.setAttribute("title",q);g.options[g.options.length]=k}if(i)i.selected=c}if(i)f.set_SelectedValue(g.options[g.selectedIndex].value,g.options[g.selectedIndex].text);else if(!i&&l!=-1){g.options[l].selected=c;f.set_SelectedValue(g.options[l].value,g.options[l].text)}else if(!u&&!i&&!m&&!f._promptText&&g.options.length>0)f.set_SelectedValue(g.options[0].value,g.options[0].text);else!u&&!i&&!m&&f.set_SelectedValue(b,b);if(g.childDropDown&&!m)for(var j=0;j<g.childDropDown.length;j++)g.childDropDown[j]._onParentChange();else if(h&&Sys.Browser.agent!==Sys.Browser.Safari&&Sys.Browser.agent!==Sys.Browser.Opera)if(document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent(e,c,d);f.get_element().dispatchEvent(s)}else document.createEventObject&&f.get_element().fireEvent("onchange");if(!f._enableAtLoading){if(f._loadingText||f._promptText||f._emptyText)g.disabled=!h||0==h.length;if(f._actualDisabledStatus)g.disabled=f._actualDisabledStatus}m&&f.raisePopulated(Sys.EventArgs.Empty)},_onChange:function(){var c=this;if(!c._isPopulated())return;var a=c.get_element();if(-1!=a.selectedIndex&&!(c._promptText&&0==a.selectedIndex))c.set_SelectedValue(a.options[a.selectedIndex].value,a.options[a.selectedIndex].text,a.options[a.selectedIndex].title);else c.set_SelectedValue(b,b)},_onParentChange:function(l,j){var d=this,m=d.get_element(),e=b,g=d._parentControlID;while(g){var f=$get(g);if(f&&-1!=f.selectedIndex){var h=f.options[f.selectedIndex].value;if(h&&h!=b){e=f.CascadingDropDownCategory+":"+h+";"+e;g=f.CascadingDropDownParentControlID;continue}}break}if(e!=b&&d._lastParentValues==e)return;d._lastParentValues=e;if(e==b&&d._parentControlID){d._setOptions(a,j);return}d._setOptions(a,j,c);if(d._servicePath&&d._serviceMethod){var i=new Sys.CancelEventArgs;d.raisePopulating(i);if(i.get_cancel())return;var k={knownCategoryValues:e,category:d._category};if(d._useContextKey)k.contextKey=d._contextKey;Sys.Net.WebServiceProxy.invoke(d._servicePath,d._serviceMethod,d._useHttpGet,k,Function.createDelegate(d,d._onMethodComplete),Function.createDelegate(d,d._onMethodError));$common.updateFormToRefreshATDeviceBuffer()}},_onMethodComplete:function(a){this._setOptions(a)},_onMethodError:function(b){var a=this;if(b.get_timedOut())a._setOptions([a._makeNameValueObject(Sys.Extended.UI.Resources.CascadingDropDown_MethodTimeout)]);else a._setOptions([a._makeNameValueObject(String.format(Sys.Extended.UI.Resources.CascadingDropDown_MethodError,b.get_statusCode()))])},_makeNameValueObject:function(a){return{name:a,value:a}},get_ParentControlID:function(){return this._parentControlID},set_ParentControlID:function(a){if(this._parentControlID!=a){this._parentControlID=a;this.raisePropertyChanged("ParentControlID")}},get_Category:function(){return this._category},set_Category:function(a){if(this._category!=a){this._category=a;this.raisePropertyChanged("Category")}},get_PromptText:function(){return this._promptText},set_PromptText:function(a){if(this._promptText!=a){this._promptText=a;this.raisePropertyChanged("PromptText")}},get_PromptValue:function(){return this._promptValue},set_PromptValue:function(a){if(this._promptValue!=a){this._promptValue=a;this.raisePropertyChanged("PromptValue")}},get_EmptyText:function(){return this._emptyText},set_EmptyText:function(a){if(this._emptyText!=a){this._emptyText=a;this.raisePropertyChanged("EmptyText")}},get_EmptyValue:function(){return this._emptyValue},set_EmptyValue:function(a){if(this._emptyValue!=a){this._emptyValue=a;this.raisePropertyChanged("EmptyValue")}},get_LoadingText:function(){return this._loadingText},set_LoadingText:function(a){if(this._loadingText!=a){this._loadingText=a;this.raisePropertyChanged("LoadingText")}},get_SelectedValue:function(){return this._selectedValue},set_SelectedValue:function(d,e,g){var a=":::",c=this;if(c._selectedValue!=d){if(!e){var f=d.indexOf(a);if(-1!=f){e=d.slice(f+3);d=d.slice(0,f);f=e.indexOf(a);if(-1!=f){g=e.slice(f+3);e=e.slice(0,f)}}}var h=c._selectedValue;c._selectedValue=d;c.raisePropertyChanged("SelectedValue");c.raiseSelectionChanged(new Sys.Extended.UI.CascadingDropDownSelectionChangedEventArgs(h,d))}Sys.Extended.UI.CascadingDropDownBehavior.callBaseMethod(c,"set_ClientState",[c._selectedValue+a+e+a+(g?a+g:b)])},get_ServicePath:function(){return this._servicePath},set_ServicePath:function(a){if(this._servicePath!=a){this._servicePath=a;this.raisePropertyChanged("ServicePath")}},get_ServiceMethod:function(){return this._serviceMethod},set_ServiceMethod:function(a){if(this._serviceMethod!=a){this._serviceMethod=a;this.raisePropertyChanged("ServiceMethod")}},get_contextKey:function(){return this._contextKey},set_contextKey:function(b){var a=this;if(a._contextKey!=b){a._contextKey=b;a.set_useContextKey(c);a.raisePropertyChanged("contextKey")}},get_useContextKey:function(){return this._useContextKey},set_useContextKey:function(a){if(this._useContextKey!=a){this._useContextKey=a;this.raisePropertyChanged("useContextKey")}},get_useHttpGet:function(){return this._useHttpGet},set_useHttpGet:function(a){if(this._useHttpGet!=a){this._useHttpGet=a;this.raisePropertyChanged("useHttpGet")}},get_enableAtLoading:function(){return this._enableAtLoading},set_enableAtLoading:function(a){if(this._enableAtLoading!=a){this._enableAtLoading=a;this.raisePropertyChanged("enableAtLoading")}},add_selectionChanged:function(a){this.get_events().addHandler(f,a)},remove_selectionChanged:function(a){this.get_events().removeHandler(f,a)},raiseSelectionChanged:function(b){var a=this.get_events().getHandler(f);a&&a(this,b)},add_populating:function(a){this.get_events().addHandler(g,a)},remove_populating:function(a){this.get_events().removeHandler(g,a)},raisePopulating:function(b){var a=this.get_events().getHandler(g);a&&a(this,b)},add_populated:function(a){this.get_events().addHandler(h,a)},remove_populated:function(a){this.get_events().removeHandler(h,a)},raisePopulated:function(b){var a=this.get_events().getHandler(h);a&&a(this,b)}};Sys.Extended.UI.CascadingDropDownBehavior.registerClass("Sys.Extended.UI.CascadingDropDownBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.CascadingDropDownBehavior,{name:"cascadingDropDown"})}if(window.Sys&&Sys.loader)Sys.loader.registerScript(b,["ExtendedBase","ExtendedCommon","WebServices"],a);else a()})();