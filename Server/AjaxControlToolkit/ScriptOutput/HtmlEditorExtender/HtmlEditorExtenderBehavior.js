// (c) 2010 CodePlex Foundation
(function(){var a=null,e="HtmlEditorExtenderBehavior",b=a,c=a;function d(){var h="ToolbarButtons",d=false,f="blur",e=true,g="unselectable";Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.HtmlEditorExtenderButton=function(){var b=this;b._name=a;b._iconIndex=a;b._title=a;b._offset=a};Sys.Extended.UI.HtmlEditorExtenderButton.prototype={get_Name:function(){return this._name},set_Name:function(){if(this._name!=value){this._name=value;this.raisePropertyChanged("Name")}},get_Title:function(){return this._title+"test-prototype-success"},set_Title:function(){if(this._title!=value){this._title=value;this.raisePropertyChanged("Title")}},get_IconIndex:function(){return this._iconIndex},set_IconIndex:function(){if(this._iconIndex!=value){this._iconIndex=value;this.raisePropertyChanged("IconIndex")}},get_Offset:function(){return this._offset},set_Offset:function(){if(this._iconIndex!=value){this._iconIndex=value;this.raisePropertyChanged("Offset")}}};Sys.Extended.UI.HtmlEditorExtenderButton.registerClass("Sys.Extended.UI.HtmlEditorExtenderButton");Sys.Extended.UI.HtmlEditorExtenderBehavior=function(f){var c=this;Sys.Extended.UI.HtmlEditorExtenderBehavior.initializeBase(c,[f]);b=Sys.Extended.UI.TextBoxWrapper.get_Wrapper(f);var d=c.get_id();c._ButtonWidth=23;c._ButtonHeight=21;c._containerTemplate={nodeName:"div",properties:{id:d+"_ExtenderContainer"},cssClasses:[g]};c._editableTemplate={nodeName:"div",properties:{id:d+"_ExtenderContentEditable",style:{width:"100%",height:"100%",borderStyle:"outset",overflow:"scroll",clear:"both"},contentEditable:e}};c._buttonTemplate={nodeName:"input",properties:{type:"button",style:{width:c._ButtonWidth+"px",height:c._ButtonHeight+"px"}},cssClasses:["ajax__html_editor_extender_button"]};c._topButtonContainerTemplate={nodeName:"div",properties:{id:d+"_ExtenderButtonContainer"}};c._container=a;c._ToolbarButtons=a;c._topButtonContainer=a;c._buttons=[];c._btnClickHandler=a;c._requested_buttons=[]};Sys.Extended.UI.HtmlEditorExtenderBehavior.prototype={initialize:function(){var d=this;Sys.Extended.UI.HtmlEditorExtenderBehavior.callBaseMethod(d,"initialize");var i=0;d._button_list=[];d._createContainer();d._createTopButtonContainer();d._createEditableDiv(d._textbox);d._createButton();var g=b._element.parentNode;while(g!=a&&g.nodeName!="FORM")g=g.parentNode;if(g==a)throw"Missing Form tag";$addHandler(b._element,f,d._textBox_onblur,e);$addHandler(c,f,d._editableDiv_onblur,e);$addHandler(g,"submit",d._editableDiv_submit,e);d._btnClickHandler=Function.createDelegate(d,d._executeCommand);for(var h=0;h<d._buttons.length;h++)$addHandler(d._buttons[h],"click",d._btnClickHandler)},_dispose:function(){var a=this;$removeHandler(b._element,f,a._textBox_onblur);$removeHandler(c,f,a._editableDiv_onblur);$removeHandler(document.forms[0],"submit",a._editableDiv_submit);for(var d=0;d<a._buttons.length;d++)$removeHandler(a._buttons[d],"click",a._btnClickHandler);Sys.Extended.UI.HtmlEditorExtenderBehavior.callBaseMethod(a,"dispose")},_createContainer:function(){var a=this,c=a.get_element();a._container=$common.createElementFromTemplate(a._containerTemplate,c.parentNode);$common.wrapElement(b._element,a._container,a._container)},_createTopButtonContainer:function(){this._topButtonContainer=$common.createElementFromTemplate(this._topButtonContainerTemplate,this._container)},_createButton:function(){var a=this;for(i=0;i<a._ToolbarButtons.length;i++){var b=$common.createElementFromTemplate(a._buttonTemplate,a._topButtonContainer);b.setAttribute("id",a._ToolbarButtons[i].Name);b.setAttribute("name",a._ToolbarButtons[i].Name);b.setAttribute("title",a._ToolbarButtons[i].Title);b.setAttribute(g,"on");b.style.backgroundPosition=a._ToolbarButtons[i].Offset;Array.add(a._buttons,b)}},_createEditableDiv:function(){var e=this.get_element();c=$common.createElementFromTemplate(this._editableTemplate,this._container);c.innerHTML=b._element.value;var a=$common.getBounds(b._element);$common.setSize(c,{width:a.width,height:a.height});$common.setVisible(b._element,d)},_editableDiv_onblur:function(){b._element.value=this.innerHTML},_textBox_onblur:function(){c.innerHTML=this.value},_editableDiv_submit:function(){var e=3,d=a;c.focus();if(Sys.Browser.agent!=Sys.Browser.Firefox)if(document.selection){d=document.selection.createRange();d.moveStart("character",e);d.select()}else{d=window.getSelection();d.collapse(c.firstChild,e)}var f=c.innerHTML.replace(/&/ig,"&amp;").replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\"/ig,"&quot;").replace(/\xA0/ig,"&nbsp;");b._element.value=f},_executeCommand:function(c){var b=Sys.Browser.agent==Sys.Browser.Firefox;b&&document.execCommand("styleWithCSS",d,d);switch(c.target.title.toUpperCase()){case"BOLD":document.execCommand("Bold",d,a);break;case"ITALIC":document.execCommand("Italic",d,a);break;case"UNDERLINE":document.execCommand("Underline",d,a);break;case"STRIKE THROUGH":document.execCommand("StrikeThrough",d,a);break;case"SUB SCRIPT":document.execCommand("Subscript",d,a);break;case"SUPER SCRIPT":document.execCommand("Superscript",d,a);break;case"JUSTIFY LEFT":document.execCommand("Justifyleft",d,a);break;case"JUSTIFY RIGHT":document.execCommand("Justifyright",d,a);break;case"JUSTIFY CENTER":document.execCommand("Justifycenter",d,a);break;case"INSERT ORDERED LIST":document.execCommand("insertOrderedList",d,a);break;case"INSERT UNORDERED LIST":document.execCommand("insertUnorderedList",d,a)}},get_ButtonWidth:function(){return this._ButtonWidth},set_ButtonWidth:function(a){if(this._ButtonWidth!=a){this._ButtonWidth=a;this.raisePropertyChanged("ButtonWidth")}},get_ButtonHeight:function(){return this._ButtonHeight},set_ButtonHeight:function(a){if(this._ButtonHeight!=a){this._ButtonHeight=a;this.raisePropertyChanged("ButtonHeight")}},get_ToolbarButtons:function(){return this._ToolbarButtons},set_ToolbarButtons:function(a){if(this._ToolbarButtons!=a){this._ToolbarButtons=a;this.raisePropertyChanged(h)}}};Sys.Extended.UI.HtmlEditorExtenderBehavior.registerClass("Sys.Extended.UI.HtmlEditorExtenderBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.HtmlEditorExtenderBehavior,{name:"HtmlEditorExtender",parameters:[{name:h,type:"HtmlEditorExtenderButton[]"}]})}if(window.Sys&&Sys.loader)Sys.loader.registerScript(e,["ExtendedBase","ExtendedCommon"],d);else d()})();